# Phase 2.4: Agent Orchestration Architecture

## Overview

This specification defines the technical architecture for orchestrating autonomous agents within the Regen Network ecosystem, using ElizaOS as the runtime framework.

---

## Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              REGEN AGENTIC PLATFORM                                  │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                         PRESENTATION LAYER                                   │    │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐      │    │
│  │  │ Discord  │  │ Twitter  │  │ Telegram │  │ Web UI   │  │ CLI      │      │    │
│  │  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘      │    │
│  └───────┼─────────────┼─────────────┼─────────────┼─────────────┼────────────┘    │
│          └─────────────┴─────────────┴──────┬──────┴─────────────┘                  │
│  ┌──────────────────────────────────────────┴──────────────────────────────────┐    │
│  │                          ELIZAOS RUNTIME                                     │    │
│  │  ┌────────────────────────────────────────────────────────────────────┐     │    │
│  │  │                    AGENT MANAGER                                    │     │    │
│  │  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌────────────┐ │     │    │
│  │  │  │   Registry   │ │  Governance  │ │   Market     │ │  Validator │ │     │    │
│  │  │  │   Reviewer   │ │   Analyst    │ │   Monitor    │ │  Monitor   │ │     │    │
│  │  │  └──────────────┘ └──────────────┘ └──────────────┘ └────────────┘ │     │    │
│  │  └───────────────────────────────────────────────────────────────────┘     │    │
│  │  ┌───────────────────────────────────────────────────────────────────┐     │    │
│  │  │ Memory │ Context │ Action Registry │ Evaluators │ Providers       │     │    │
│  │  └───────────────────────────────────────────────────────────────────┘     │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
│  ┌──────────────────────────────────────────────────────────────────────────────┐   │
│  │                           MCP INTEGRATION LAYER                              │   │
│  │  ┌─────────────────────┐  ┌─────────────────────┐  ┌────────────────────┐   │   │
│  │  │    KOI MCP          │  │   LEDGER MCP        │  │  TX BUILDER MCP    │   │   │
│  │  └─────────────────────┘  └─────────────────────┘  └────────────────────┘   │   │
│  └──────────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Agent Specifications

### AGENT-001: Registry Reviewer Agent

```yaml
agent_id: AGENT-001
name: RegenRegistryReviewer
type: domain_specialist
runtime: ElizaOS

character_definition:
  name: "Registry Reviewer"
  bio: |
    I am an autonomous agent specialized in reviewing credit class applications,
    project registrations, and credit batch issuances for Regen Registry.

  system_prompt: |
    You are the Regen Registry Reviewer Agent. Your responsibilities:
    1. Pre-screening credit class creator applications
    2. Validating project registration submissions
    3. Reviewing credit batch issuance requests
    4. Maintaining quality standards

    Be thorough, objective, and transparent. Cite evidence.
    Escalate when confidence < 0.7.

  knowledge_domains:
    - ecological_credit_methodologies
    - carbon_accounting
    - mrv_protocols
    - regen_registry_standards

plugins:
  - "@elizaos/plugin-knowledge"
  - "@regen/plugin-ledger-mcp"
  - "@regen/plugin-registry-tools"

actions:
  - analyze_methodology
  - validate_project
  - review_batch

evaluators:
  - methodology_completeness
  - duplicate_detector
  - risk_assessor

governance_integration:
  authority_level: Layer 2
  can_propose: true
  can_execute: false
  escalation_threshold: 0.7
```

### AGENT-002: Governance Analyst Agent

```yaml
agent_id: AGENT-002
name: RegenGovernanceAnalyst
type: analytical_specialist
runtime: ElizaOS

character_definition:
  name: "Governance Analyst"
  bio: |
    I analyze governance proposals, track voting patterns, and provide
    decision support for Regen Network token holders.

  system_prompt: |
    You are the Regen Governance Analyst Agent. Your responsibilities:
    1. Analyzing and summarizing proposals
    2. Tracking voting progress and predicting outcomes
    3. Providing historical context
    4. Alerting to important governance events

    Be objective. Never endorse specific positions.

plugins:
  - "@elizaos/plugin-knowledge"
  - "@regen/plugin-ledger-mcp"
  - "@regen/plugin-social"

actions:
  - analyze_proposal
  - track_voting
  - generate_report

governance_integration:
  authority_level: Layer 1 (informational only)
  can_propose: false
  can_execute: false
```

### AGENT-003: Market Monitor Agent

```yaml
agent_id: AGENT-003
name: RegenMarketMonitor
type: market_specialist
runtime: ElizaOS

character_definition:
  name: "Market Monitor"
  bio: |
    I monitor the Regen ecocredit marketplace, detecting anomalies,
    tracking liquidity, and providing market intelligence.

  system_prompt: |
    You are the Regen Market Monitor Agent. Your responsibilities:
    1. Detecting price anomalies and potential manipulation
    2. Monitoring market liquidity and health
    3. Analyzing retirement patterns
    4. Generating market intelligence reports

    Prioritize market integrity. Avoid false positives.

plugins:
  - "@elizaos/plugin-knowledge"
  - "@regen/plugin-ledger-mcp"
  - "@regen/plugin-market-analytics"

actions:
  - detect_anomaly
  - assess_liquidity
  - analyze_retirements

governance_integration:
  authority_level: Layer 1-2
  can_propose: true (freeze orders)
  can_execute: false
```

### AGENT-004: Validator Monitor Agent

```yaml
agent_id: AGENT-004
name: RegenValidatorMonitor
type: infrastructure_specialist
runtime: ElizaOS

character_definition:
  name: "Validator Monitor"
  bio: |
    I monitor validator performance, network decentralization, and
    staking dynamics on Regen Network.

  system_prompt: |
    You are the Regen Validator Monitor Agent. Your responsibilities:
    1. Tracking validator uptime and performance
    2. Monitoring delegation flows
    3. Assessing network decentralization
    4. Alerting on infrastructure risks

    Prioritize network security and decentralization.

plugins:
  - "@elizaos/plugin-knowledge"
  - "@regen/plugin-ledger-mcp"
  - "@regen/plugin-infrastructure"

actions:
  - assess_validator
  - analyze_delegation_flows
  - assess_decentralization

governance_integration:
  authority_level: Layer 1-3
  can_propose: true (validator params)
  can_execute: false
```

---

## Orchestration Framework

```yaml
orchestrator:
  name: RegenAgentOrchestrator
  runtime: ElizaOS

  agent_lifecycle:
    initialization:
      - load_character_definition
      - initialize_memory_stores
      - register_with_mcp_servers
      - subscribe_to_event_streams

    operation:
      - receive_trigger
      - load_context
      - execute_workflow (ooda_loop)
      - persist_results
      - distribute_outputs

  event_routing:
    blockchain_events:
      MsgCreateClass: [AGENT-001]
      MsgCreateProject: [AGENT-001]
      ProposalSubmitted: [AGENT-002]
      SellOrderCreated: [AGENT-003]
      MsgDelegate: [AGENT-004]

    scheduled_events:
      every_1h: [AGENT-003.liquidity_check]
      every_6h: [AGENT-002.voting_update]
      daily: [AGENT-003.market_report, AGENT-004.decentralization_check]

  inter_agent_communication:
    protocol: message_queue
    patterns: [request_response, publish_subscribe, delegation]

  resource_management:
    rate_limits:
      koi_mcp: 100 req/min
      ledger_mcp: 50 req/min
    concurrency:
      max_parallel_workflows: 10
    budgets:
      daily_llm_tokens: 1_000_000
```

---

## Security Architecture

```yaml
security:
  authentication:
    agent_identity: ed25519_keypairs
    mcp_auth: api_key + mTLS

  authorization:
    permission_model: capability_based
    capabilities:
      AGENT-001: [READ classes/projects, PROPOSE class_creator]
      AGENT-002: [READ proposals/votes, WRITE forum_posts]
      AGENT-003: [READ orders/trades, PROPOSE order_freeze]
      AGENT-004: [READ validators/delegations, PROPOSE param_changes]

  transaction_signing:
    policy: multi_sig_with_human
    threshold: 2_of_3 (agent + human + backup)

  audit_logging:
    events: [initialized, workflow_started, decision_made, escalation_triggered]
    storage:
      short_term: postgresql (30 days)
      long_term: koi_objects (permanent)
```

---

## Deployment Architecture

```yaml
deployment:
  infrastructure:
    runtime: kubernetes
    replicas: 3 per agent
    databases:
      postgresql: managed, multi_az
    message_queue: redis_streams

  environments:
    development: all agents, single replica, testnet
    staging: all agents, production config, mainnet readonly
    production: all agents, full HA, mainnet full access

  monitoring:
    metrics: [uptime, latency, confidence, escalation_rate, error_rate]
    alerting: [agent_down, error_rate_high, escalation_spike]

  ci_cd:
    pipeline:
      - lint_and_test
      - security_scan
      - build_container
      - deploy_staging
      - integration_tests
      - manual_approval
      - deploy_production
```
