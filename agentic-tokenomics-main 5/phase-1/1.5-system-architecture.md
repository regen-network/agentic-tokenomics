# Phase 1.5: System Architecture Synthesis

## Overview

This document synthesizes findings from Phases 1.1-1.4 into a comprehensive system architecture for the Regen Agentic Tokenomics platform.

## System Components

### COMP-001: On-Chain State Monitoring
| Attribute | Value |
|-----------|-------|
| **Function** | Real-time blockchain event processing |
| **Technology** | Tendermint WebSocket + Event Indexer |
| **Data Source** | Regen Ledger MCP |
| **Outputs** | Event stream, state cache |

### COMP-002: Off-Chain Data Ingestion
| Attribute | Value |
|-----------|-------|
| **Function** | Knowledge base access and enrichment |
| **Technology** | KOI MCP + Apache Jena |
| **Data Source** | Notion, Discourse, GitHub, etc. |
| **Outputs** | Semantic search, entity resolution |

### COMP-003: Agent Reasoning Layer
| Attribute | Value |
|-----------|-------|
| **Function** | Autonomous decision-making |
| **Technology** | ElizaOS Runtime |
| **Components** | 4 agent personas |
| **Outputs** | Decisions, recommendations, reports |

### COMP-004: Decision Execution Layer
| Attribute | Value |
|-----------|-------|
| **Function** | Translate decisions to on-chain actions |
| **Technology** | TX Builder + DAO DAO |
| **Outputs** | Signed transactions, proposals |

### COMP-005: Audit and Transparency Layer
| Attribute | Value |
|-----------|-------|
| **Function** | Immutable decision logging |
| **Technology** | KOI Objects |
| **Outputs** | Audit trail, provenance records |

### COMP-006: Human Escalation Interface
| Attribute | Value |
|-----------|-------|
| **Function** | Human oversight and override |
| **Technology** | Web Dashboard + Notifications |
| **Outputs** | Human decisions, overrides |

## Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           EXTERNAL INTERFACES                            │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────────────┐   │
│  │ Discord │ │ Twitter │ │Telegram │ │ Forum   │ │ Dashboard (Web) │   │
│  └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘ └────────┬────────┘   │
└───────┼──────────┼──────────┼──────────┼─────────────────┼──────────────┘
        └──────────┴──────────┴──────────┴─────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         COMP-003: AGENT LAYER                            │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    ElizaOS Runtime                               │   │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌─────────┐ │   │
│  │  │   Registry   │ │  Governance  │ │    Market    │ │Validator│ │   │
│  │  │   Reviewer   │ │   Analyst    │ │   Monitor    │ │ Monitor │ │   │
│  │  │   AGENT-001  │ │   AGENT-002  │ │   AGENT-003  │ │AGENT-004│ │   │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └─────────┘ │   │
│  │  ┌────────────────────────────────────────────────────────────┐ │   │
│  │  │ Memory │ Context │ Action Registry │ Evaluators │ Providers│ │   │
│  │  └────────────────────────────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└────────────────────────────────┬────────────────────────────────────────┘
                                 │
        ┌────────────────────────┼────────────────────────┐
        ▼                        ▼                        ▼
┌───────────────┐      ┌───────────────┐      ┌───────────────────┐
│ COMP-001      │      │ COMP-002      │      │ COMP-004          │
│ Ledger MCP    │      │ KOI MCP       │      │ TX Builder        │
│ ┌───────────┐ │      │ ┌───────────┐ │      │ ┌───────────────┐ │
│ │ Events    │ │      │ │ Search    │ │      │ │ Build Msg     │ │
│ │ Queries   │ │      │ │ Resolve   │ │      │ │ Simulate      │ │
│ │ State     │ │      │ │ SPARQL    │ │      │ │ Sign (w/human)│ │
│ └───────────┘ │      │ └───────────┘ │      │ └───────────────┘ │
└───────┬───────┘      └───────┬───────┘      └─────────┬─────────┘
        │                      │                        │
        ▼                      ▼                        ▼
┌───────────────┐      ┌───────────────┐      ┌───────────────────┐
│ Regen Ledger  │      │ Apache Jena   │      │ DAO DAO           │
│ (Blockchain)  │      │ (Knowledge    │      │ (CosmWasm)        │
│               │      │  Graph)       │      │                   │
│ • Ecocredit   │      │ • 64K docs    │      │ • Arbiter DAOs    │
│ • Governance  │      │ • 78K code    │      │ • Subgroup DAOs   │
│ • Staking     │      │ • Embeddings  │      │ • Escrow          │
│ • Marketplace │      │               │      │                   │
└───────────────┘      └───────────────┘      └───────────────────┘
        │                      │
        └──────────┬───────────┘
                   ▼
        ┌───────────────────┐
        │ COMP-005          │
        │ Audit Layer       │
        │ ┌───────────────┐ │
        │ │ KOI Objects   │ │
        │ │ Decision Logs │ │
        │ │ Provenance    │ │
        │ └───────────────┘ │
        └───────────────────┘
```

## Data Flow Patterns

### Pattern 1: Event-Driven Workflow
```
Blockchain Event → Event Listener → Agent Trigger → OODA Loop → Decision → Execution
```

### Pattern 2: Scheduled Analysis
```
Timer → Agent Activation → State Query → Analysis → Report Generation → Distribution
```

### Pattern 3: Human Escalation
```
Agent Decision (low confidence) → Escalation → Human Interface → Human Decision → Execution
```

### Pattern 4: Audit Trail
```
Any Action → Decision Record → KOI Object Creation → Permanent Storage
```

## Integration Points

| Source | Target | Protocol | Data |
|--------|--------|----------|------|
| Ledger | Agent | WebSocket | Events |
| Ledger | Agent | gRPC | State queries |
| KOI | Agent | MCP/HTTP | Search, resolve |
| Agent | Dashboard | WebSocket | Status, alerts |
| Agent | Forum | REST API | Posts, summaries |
| Agent | KOI | HTTP | Audit objects |
| Dashboard | Agent | REST API | Overrides |

## Security Architecture

### Authentication
- Agent identity: Ed25519 keypairs
- MCP auth: API keys + mTLS
- Human auth: Wallet signatures

### Authorization
- Capability-based permissions per agent
- Layer-specific action restrictions
- Multi-sig for high-value transactions

### Audit
- All decisions logged to KOI
- Immutable provenance chain
- Human overrides tracked

## Deployment Model

```
Production Environment
├── Kubernetes Cluster
│   ├── ElizaOS Runtime (3 replicas per agent)
│   ├── Redis Cluster (cache + queues)
│   └── API Gateway
├── Managed Services
│   ├── PostgreSQL (agent state)
│   └── Monitoring (Prometheus + Grafana)
└── External
    ├── Regen Ledger Node
    ├── KOI Infrastructure
    └── DAO DAO Contracts
```

## Key Design Decisions

1. **ElizaOS as Runtime**: Chosen for existing Regen integration, plugin architecture, and Web3 capabilities

2. **KOI for Audit**: Provides semantic structure, permanent storage, and knowledge graph integration

3. **4-Layer Governance**: Balances automation efficiency with human oversight and constitutional safeguards

4. **MCP for Integration**: Standard protocol for tool access, enabling modular architecture

5. **DAO DAO for Arbitration**: Leverages existing CosmWasm infrastructure for subDAO governance

## Success Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| Automation Rate | 65-75% | Decisions without human intervention |
| Agent Accuracy | >90% | Decisions not overridden |
| Response Time | <24h | Time from trigger to decision |
| Availability | 99.5% | Agent uptime |
| Audit Coverage | 100% | Decisions with KOI records |
